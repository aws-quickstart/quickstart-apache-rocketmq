// Add steps as necessary for accessing the software, post-configuration, and testing. Don’t include full usage instructions for your software, but add links to your product documentation for that information.
//Should any sections not be applicable, remove them

=== Logging into an Apache RocketMQ NameServer or Broker server node

. Add a PEM key pair. For example:

[source,bash]
--
ssh-add -k /Users/username/tmp/rocketmqXXX.pem
--

[start=2]
. Sign into the bastion host.

[source,bash]
--
ssh -A  ec2-user@ecXXXXXXXX.cn-north-1.compute.amazonaws.com.cn
--

:xrefstyle: short
[start=3]
. Get the IP address of the node you want.
.. Open the https://console.aws.amazon.com/ec2/[Amazon EC2 console].
.. On the *Instances* screen, select the checkbox for the instance. Note the *Private IPs* in the *Description* tab, as shown in <<IPaddress>>.

[#IPaddress]
.EC2 instance private IP address
image::../images/NameServerIPAddress.png[NameServerAddress,width=75%,height=75%]

[start=4]
. From the bastion host, log into the node with the IP address. For example:

[source,bash]
--
(ec2-user@ip-10-0-136-135) $ ssh 10.0.6.235

Last login: Wed Jan  6 04:55:01 2021 from ip-10-0-136-135.cn-north-1.compute.internal

       __|  __|_  )
       _|  (     /   Amazon Linux 2 AMI
      ___|\___|___|
https://aws.amazon.com/amazon-linux-2/

[ec2-user@ip-10-0-6-235 ~]$
--

[start=5]

. Once you are signed into the node, you can use https://rocketmq.apache.org/docs/cli-admin-tool/[Apache RocketMQ command-line tools] to query, manage, and diagnose issues.

=== How to view Web Console from Apache RocketMQ using your browser

The default deployment installs the web console on each NameServer instance. However, as NameServer instances run on the private subnets, you cannot access the 8080 port of the NameServer private IP address directly. 

Do the following to configure an SSH Tunnel to the bastion host and access web console through it.

. Using the ssh command to establish a ssh connection to the bastion host, some of the parameters in the following image need to be replaced with parameters corresponding to the user environment.

NOTE: These parameters are denoted in [red]#red#

Command ：
[source,bash]
--
ssh -qTfnN -D <PORTNUMBER> -i <KEYPAIR> <USERNAME>@<HOSTNAME>
--
Example:
[source,bash]
--
ssh -qTfnN -D 40011  -i "rocketMQ.pem" ec2-user@ec2-54-223-36-247.cn-north-1.compute.amazonaws.com.cn
--
. After configuring the SSH tunnel, set up proxy in your browser, which has a lot of plug-ins that automatically select proxy, we are using SwitchyOmega as an example in this article.
. To install the SwitchyOmega browser  plug-in in the following browsers: (Microsoft Edge browser please visit link:https://microsoftedge.microsoft.com/addons/detail/proxy-switchyomega/fdbloeknjpnloaggplaobopplkdhnikc?hl=en-US[this link], Firefox browser access link:https://addons.mozilla.org/en-US/firefox/addon/switchyomega/?utm_source=addons.mozilla.org&utm_medium=referral&utm_content=search[this link], Chrome browser access link:https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif?hl=en-US[this link]).
. Once the SwitchyOmega plug-in is installed, open the plug-in options page and click on the "New Profile" on the left, as shown in the following image:

image::../images/switchyOmega1.png[SwitchyOmega,width=50%,height=50%]
[start=5]
. Enter the name of "New Profile" in the pop-up window and click the create button at the bottom right, as follows:

image::../images/switchyOmega2.png[SwitchyOmega,width=50%,height=50%]
[start=6]
. Enter the information for proxy server, as shown below, and click on the apple changes at the bottom left, noting that the value for port needs to be set to the local port where you set up the ssh tunnel, see the number after the first step "-D" parameter, as shown below:
. Click on the SwitchyOmega plug-in and select the RocketMQ profile you just created, as shown below:

image::../images/switchyOmega4.png[SwitchyOmega,width=50%,height=50%]
[start=8]
. After completing this step above, the browser will send all traffic through the local port 40011 proxy to the Bastion  Host machine.
. Enter the private IP address of any of the deployed Nameservers in your browser plus port 8080 (for example:http://10.0.xx.xx:8080), and you can find the corresponding instance for the nameserver via EC2 Console and find the corresponding IP address, as shown below:

image::../images/ec2.png[ec2,width=90%,height=90%]
[start=10]
. The browser should be able to display the deployed RocketMQ cluster properly, as shown in the following image:

image::../images/rocketMQConsole.png[console,width=90%,height=90%]

=== Apache RocketMQ resources

==== NameServer nodes

* Apache RocketMQ installation guide: `/home/ec2-user/rocketmq-deploy`
* Apache RocketMQ installation directory: `/home/ec2-user/rocketmq-deploy/rocketmq-all-4.7.1-bin-release` or `/home/ec2-user/rocketmq-deploy/rocketmq-all-4.8.0-bin-release`
* Deployment script installation log used to troubleshoot error messages: `/home/ec2-user/rocketmq-deploy/install.log`
* Apache RocketMQ web console: `/home/ec2-user/rocketmq-deploy/rocketmq-console-ng-1.0.0.jar`

==== Broker server nodes

* Apache RocketMQ installation guide: `/home/ec2-user/rocketmq-deploy`
* Apache RocketMQ installation directory: `/home/ec2-user/rocketmq-deploy/rocketmq-all-4.7.1-bin-release` or `/home/ec2-user/rocketmq-deploy/rocketmq-all-4.8.0-bin-release`
* Deployment script installation logs: `/home/ec2-user/rocketmq-deploy/install.log`
* Configuration file: `/home/ec2-user/rocketmq-deploy/rocketMQ-config/`
* Apache RocketMQ local file storage: `/home/ec2-user/rocketmq-deploy/rmqstore`



== Best practices for using {partner-product-short-name} on AWS
// Provide post-deployment best practices for using the technology on AWS, including considerations such as migrating data, backups, ensuring high performance, high availability, etc. Link to software documentation for detailed information.
Please check the following links from Apache RocketMQ official website for best practice of using RocketMQ:

. link:https://rocketmq.apache.org/docs/best-practice-namesvr/[Best Practice of Nameserver]
. link:https://rocketmq.apache.org/docs/best-practice-broker/[Best Practice of Broker]
. link:https://rocketmq.apache.org/docs/best-practice-producer/[Best Practice of Producer]
. link:https://rocketmq.apache.org/docs/best-practice-consumer/[Best Practice of Consumer]



